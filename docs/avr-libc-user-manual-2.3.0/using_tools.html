<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<title>AVR-LibC: Using the GNU tools</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="dox.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">AVR-LibC
   &#160;<span id="projectnumber">2.3.0git</span>
   </div>
   <div id="projectbrief">Standard C library for AVR-GCC</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table>
  <tr>
    <td align="left"><a href="https://avrdudes.github.io/avr-libc/"><h2>AVR-LibC Documen&shy;tation</h2></a></td>
    <td align="center" colspan=4>
      <div class="logo"><img src="avr-libc-logo.png" alt="Logo" align="middle" border="0"></div>
      <div class="invlogo"><img src="avr-libc-logo-inverted.png" alt="Logo" align="middle" border="0"></div>
    </td>
    <td align="right" colspan=2><a href="https://github.com/avrdudes/avr-libc/"><h2>AVR-LibC Development Pages</h2></a></td>
  </tr>
  <tr>
    <td align="center" width="15%"><a href="index.html"><h2>Main Page</h2></a></td>
    <td align="center" width="15%"><a href="pages.html"><h2>User Manual</h2></a></td>
    <td align="center" width="15%"><a href="modules.html"><h2>Library Refe&shy;rence</h2></a></td>
    <td align="center" width="8%"><a href="FAQ.html"><h2>FAQ</h2></a></td>
    <td align="center" width="15%"><a href="group__demos.html"><h2>Example Projects</h2></a></td>
    <td align="center" width="8%"><a href="files.html"><h2>File List</h2></a></td>
    <td align="center" width="8%"><a href="Global_01Index.html"><h2>Index</h2></a></td>
  </tr>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Using the GNU tools </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a short summary of the AVR-specific aspects of using the GNU tools. Normally, the generic documentation of these tools is fairly large and maintained in <code>texinfo</code> files. Command-line options are explained in detail in the manual page.</p>
<h1><a class="anchor" id="using_avr_gcc"></a>
Options for the C compiler avr-gcc</h1>
<h2><a class="anchor" id="using_avr_gcc_mach_opt"></a>
Machine-specific options for the AVR</h2>
<p>The following machine-specific options are recognized by the C compiler frontend. The preprocessor will define the macros <code>__AVR</code> and <code>__AVR__</code> (to the value 1) when compiling for an AVR target. The macro <code>AVR</code> will be defined as well, except in strict ANSI mode.</p>
<p>There are many options supported by avr-gcc, which also depend on the compiler version. For a complete overview, please see the documentation of avr-gcc's command line options. Here are links to supported options of the respective release series:</p>
<ul>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc/AVR-Options.html">Current development</a> (work in progress)</li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-15.1.0/gcc/AVR-Options.html">v15</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-14.2.0/gcc/AVR-Options.html">v14.2</a>, <a href="https://gcc.gnu.org/onlinedocs/gcc-14.3.0/gcc/AVR-Options.html">v14.3</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-13.2.0/gcc/AVR-Options.html">v13.2</a>, <a href="https://gcc.gnu.org/onlinedocs/gcc-13.3.0/gcc/AVR-Options.html">v13.3</a>, <a href="https://gcc.gnu.org/onlinedocs/gcc-13.4.0/gcc/AVR-Options.html">v13.4</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-12.3.0/gcc/AVR-Options.html">v12.3</a>, <a href="https://gcc.gnu.org/onlinedocs/gcc-12.4.0/gcc/AVR-Options.html">v12.4</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-11.4.0/gcc/AVR-Options.html">v11</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-10.5.0/gcc/AVR-Options.html">v10</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-9.5.0/gcc/AVR-Options.html">v9</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-8.5.0/gcc/AVR-Options.html">v8</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-7.5.0/gcc/AVR-Options.html">v7</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-6.5.0/gcc/AVR-Options.html">v6</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-5.5.0/gcc/AVR-Options.html">v5</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-4.9.4/gcc/AVR-Options.html">v4.9</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-4.8.5/gcc/AVR-Options.html">v4.8</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-4.7.4/gcc/AVR-Options.html">v4.7</a></li>
</ul>
<p>Apart from the documentation of command line options, the linked pages also contain:</p>
<ul>
<li>The documentation of <a href="https://gcc.gnu.org/onlinedocs/gcc/AVR-Options.html#avr-macros">built-in macros</a> like <code>__AVR_ARCH__</code>, <code>__AVR_ATmega328P__</code> and <code>__AVR_HAVE_MUL__</code>, just to mention a few.</li>
<li>How the compiler treats the <a href="https://gcc.gnu.org/onlinedocs/gcc/AVR-Options.html#ramp"><code>RAMPX</code>, <code>RAMPY</code>, <code>RAMPZ</code> and <code>RAMPD</code> special function registers</a> on devices that have (one of) them.</li>
<li>How the compiler treats the <a href="https://gcc.gnu.org/onlinedocs/gcc/AVR-Options.html#eind"><code>EIND</code> special function register</a> on devices with more than 128 KiB of program memory, and how indirect calls are realized on such devices.</li>
</ul>
<dl>
<dt><code>-mmcu=<em>arch</em></code> </dt>
<dd></dd>
<dt><code>-mmcu=<em>mcu</em></code> </dt>
<dd><p class="startdd">Compile code for architecture <code><em>arch</em></code> resp. AVR device <code><em>mcu</em></code>.</p>
<p class="interdd">Since GCC v5, the compiler no more supports indivitual devices, instead the compiler comes with <a href="https://gcc.gnu.org/wiki/avr-gcc#spec-files">device specs files</a> that describe which options to use with each sub-processes like pre-processor, compiler proper, assembler and linker.</p>
<p class="interdd">The purpose of these specs files is to add support for AVR devices that the compiler does not yet support.</p>
<p class="enddd">The easiest way to add support for an unsupported device is to use device support from an <a href="https://gcc.gnu.org/wiki/avr-gcc#atpack">atpack archive</a> as provided by the hardware manufacturer. Apart from the <code><em>mcu</em></code> specific specs file, it provides device headers <code>io*.h</code>, startup code <code>crt<em>mcu</em>.o</code> and device library <code>lib<em>mcu</em>.a</code>.  </p>
</dd>
</dl>
<h2><a class="anchor" id="using_sel_gcc_opts"></a>
Selected general compiler options</h2>
<p>The following general gcc options might be of some interest to AVR users.</p>
<dl>
<dt><a class="anchor" id="gcc_optO"></a><code>-O<em>n</em></code> </dt>
<dd><p class="startdd">Optimization level <em>n</em>. Increasing <em>n</em> is meant to optimize more.</p>
<p class="interdd"><b><code>-O0</b></code> reduces compilation time and makes debugging produce the expected results. This is the default.<br  />
 Turning off all optimizations will prevent some warnings from being issued since the generation of those warnings depends on code analysis steps that are only performed when optimizing (unreachable code, unused variables). Moreover, the delay routines in <code>&lt;<a class="el" href="delay_8h.html">util/delay.h</a>&gt;</code> require optimization to be turned on.</p>
<p class="interdd"><b><code>-O2</b></code> optimizes for speed, but without enabling very expensive optimizations like <code>-O3</code> does.</p>
<p class="interdd"><b><code>-Os</b></code> turns on all <code>-O2</code> optimizations except those that often increase code size. In most cases, this is the preferred optimization level for AVR programs.</p>
<p class="interdd"><b><code>-Og</b></code> optimizes debugging experience. This should be the optimization level of choice for the standard edit-compile-debug cycle, offering a reasonable level of optimization while maintaining fast compilation and a good debugging experience.</p>
<p class="interdd"><b><code>-O3</b></code> attempts to inline all "simple" functions and might unroll some loops. For the AVR target, this will normally constitute a large pessimization due to the code increase.</p>
<p class="interdd"><b><code>-O</b></code> is equivalent to <b><code>-O1</b></code>. The compiler tries to reduce code size and execution time, without performing any optimizations that take a great deal of compilation time.</p>
<p class="enddd">See also the <a class="el" href="FAQ.html#faq_gdboptimize">appropriate FAQ entry</a> for issues regarding debugging optimized code.  </p>
</dd>
<dt><a class="anchor" id="gcc_minusW"></a><code>-Wp,<em>preprocessor-options</em></code> </dt>
<dd></dd>
<dt><code>-Wa,<em>assembler-options</em></code> </dt>
<dd></dd>
<dt><code>-Wl,<em>linker-options</em></code> </dt>
<dd><p class="startdd">Pass the listed options to the C preprocessor, the assembler or the linker, respectively. Several options can be passed at once when they are separated by a <code></code>, (comma). </p>
<p class="enddd"></p>
</dd>
<dt><a class="anchor" id="opt_g"></a><code>-g</code> </dt>
<dd><p class="startdd">Generate debugging information that can be used by avr-gdb. GCC v12 changed the default from STABS to DWARF. Different DWARF levels can be selected by <code>-g2</code> or <code>-gdwarf-3</code>. <br  />
 The compiler may use GNU extensions to the DWARF format. When a debugger has problems with that, try <code>-gstrict-dwarf</code>. </p>
<p class="enddd"></p>
</dd>
<dt><a class="anchor" id="opt_x"></a><code>-x <em>lang</em></code> </dt>
<dd></dd>
<dt><code>-x none</code> </dt>
<dd><p class="startdd">Compile the following files in language <em>lang</em>. Values for <em>lang</em> are: <code>c</code>, <code>c++</code>, <code>assembler</code>, <code>assembler-with-cpp</code> and <code>none</code>.</p>
<p class="interdd">For example, GCC does not recognize the <code>.asm</code> file extension as assembly source. With <code>-x assembler-with-cpp file.asm</code>, the compiler first runs the C preprocessor on <code>file.asm</code> (so that <code>#include &lt;<a class="el" href="io_8h.html">avr/io.h</a>&gt;</code> can be used in assembly), and then calls the assembler.</p>
<p class="interdd">Another use case is to compile a C file that's read from standard input, which is specified as <code>-</code> (dash) instead of the name of a source file. As no source file name is specified, the compiler must be told which language to use: The command </p><pre class="fragment">$ echo '#include &lt;avr/io.h&gt;' | avr-gcc -xc - -mmcu=atmega8 -E -dM | grep _VECTOR</pre><p> pre-processes the C file <code>#include &lt;<a class="el" href="io_8h.html">avr/io.h</a>&gt;</code> and writes all macro definitions to stdout. The output is then filtered by <code>grep</code> to show all possible <a class="el" href="group__avr__interrupts.html#gad28590624d422cdf30d626e0a506255f">ISR</a> vector names for ATmega8.</p>
<p class="interdd"><code>-x none</code> returns to the default for the following inputs, i.e. infer the respective source languages from the file extensions. </p>
<p class="enddd"></p>
</dd>
<dt><a class="anchor" id="opt_save_temps"></a><code>-save-temps</code> </dt>
<dd></dd>
<dt><code>-save-temps=obj</code> </dt>
<dd></dd>
<dt><code>-save-temps=cwd</code> </dt>
<dd></dd>
<dt><a class="anchor" id="opt_fverbose_asm"></a><code>-fverbose-asm</code> </dt>
<dd></dd>
<dt><code>-dumpbase <em>base</em></code> </dt>
<dd></dd>
<dt><code>-dumpdir <em>dir</em></code> </dt>
<dd><p class="startdd">Don't remove temporary, intermediate files like C preprocessor output and assembly code generated by the compiler. The intermediate files have file extension <code>.i</code> (preprocessed C), <code>.ii</code> (preprocessed C++) and <code>.s</code> (preprocessed assembly, compiler-generated assembly).</p>
<p class="interdd"><code>-dumpbase</code> and <code>-dumpdir</code> can be used to adjust file names and locations.</p>
<p class="interdd">With <code>-fverbose-asm</code>, the compiler adds the high level source code to the assembly output. Compiling without debugging information (<code>-g0</code>) improves legibility of the generated assembly.</p>
<p class="interdd">The preprocessed files can be used to check if macro expansions work as expected. With <code>-g3</code> or higher, the preprocessed files will also contain all macro definitions and indications where they are defined: Built-in, on the command line, or in some header file as indicated by <code>#line</code> notes. </p>
<p class="enddd"></p>
</dd>
<dt><code>-l<em>name</em></code> </dt>
<dd><p class="startdd">Locate the archive library named <code>lib</code><em>name</em><code>.a</code>, and use it to resolve currently unresolved symbols from it. The library is searched along a path that consists of builtin pathname entries that have been specified at configure time (e. g. <code>/usr/local/avr/lib</code> on Unix systems), possibly extended by pathname entries as specified by <code>-L</code> options (that must precede the <code>-l</code> options on the command-line). </p>
<p class="enddd"></p>
</dd>
<dt><code>-L<em>path</em></code> </dt>
<dd><p class="startdd">Additional directory <em>path</em> to look for archive libraries requested by <code>-l</code> options. </p>
<p class="enddd"></p>
</dd>
<dt><a class="anchor" id="opt_ffunction_sections"></a><code>-ffunction-sections</code> </dt>
<dd></dd>
<dt><a class="anchor" id="opt_fdata_sections"></a><code>-fdata-sections</code> </dt>
<dd><p class="startdd">Put each function resp. object in static storage in its own <a class="el" href="mem_sections.html#sec_input">input section</a>. This is used with <code>-Wl,--gc-sections</code> so the linker can better garbage-collect unused sections, which are sections that are neither referenced by other sections, nor are marked as <code>KEEP</code>, nor are referenced by an entry symbol. </p>
<p class="enddd"></p>
</dd>
<dt><code>-mrelax</code> </dt>
<dd><p class="startdd">Replace <code>JMP</code> and <code>CALL</code> instructions with the faster and shorter <code>RJMP</code> and <code>RCALL</code> instructions if possible. That optimization is performed by the linker, and the assembler must not resolve some expressions, which is all arranged by <code>-mrelax</code>. </p>
<p class="enddd"></p>
</dd>
<dt><code>-Tbss <em>org</em></code> </dt>
<dd></dd>
<dt><code>-Tdata <em>org</em></code> </dt>
<dd></dd>
<dt><code>-Ttext <em>org</em></code> </dt>
<dd><p class="startdd">Start the <code>.bss</code>, <code>.data</code>, or <code>.text</code> section at VMA address <em>org</em>, respectively. </p>
<p class="enddd"></p>
</dd>
<dt><code>-T <em>scriptfile</em></code> </dt>
<dd><p class="startdd">Use <em>scriptfile</em> as the linker script, replacing or augmenting the default linker script.</p>
<p class="interdd">Default linker scripts are stored in a system-specific location (e. g. under <code>/usr/local/avr/lib/ldscripts</code> on Unix systems), and consist of the AVR architecture name (<code>avr2</code> through <code>avrxmega7</code>) with the suffix <code>.x</code> appended. They describe how the various <a class="el" href="mem_sections.html">memory sections</a> will be linked together and which input sections go into them. Notice that the default linker scripts are part of the linker binary, changing them on file will have no effect.</p>
<p class="interdd">For a simple linker script augmentation, see the avr-gcc Wiki on <a href="https://gcc.gnu.org/wiki/avr-gcc#Address_Spaces">named address spaces</a>. </p>
<p class="enddd"></p>
</dd>
<dt><code>-nostdlib</code> </dt>
<dd><p class="startdd">Don't link against standard libraries.</p>
<p class="enddd"></p>
</dd>
<dt><code>-nodefaultlibs</code> </dt>
<dd><p class="startdd">Don't link against default libraries.</p>
<p class="enddd"></p>
</dd>
<dt><code>-nodevicelib</code> </dt>
<dd><p class="startdd">Don't link against AVR-LibC's <code>lib<em>mcu</em>.a</code> that contains EEPROM support and other stuff. This can be used when no such library is available. </p>
<p class="enddd"></p>
</dd>
<dt><code>-nostartfiles</code> </dt>
<dd><p class="startdd">Don't link against AVR-LibC's <a class="el" href="mem_sections.html#sec_dot_init">startup code</a> <code>crt<em>mcu</em>.o</code>.</p>
<p class="interdd">Notice that parts of the startup code are provided by <code>libgcc.a</code>. To get rid of that, one can <code>-nostdlib</code> or <code>-nodefaultlibs</code>; however that also removes other code like functions required for arithmetic. To just get rid of the startup bits, define the respective symbols, for example <br  />
 <code>-Wl,--defsym,__do_clear_bss=0</code> and similar for <code>__do_copy_data</code>, <code>__do_global_ctors</code> and <code>__do_global_dtors</code>. </p>
<p class="enddd"></p>
</dd>
<dt><code>-funsigned-char</code> </dt>
<dd><p class="startdd">This option changes the binary interface!<br  />
 Make any unqualfied <code>char</code> type an unsigned char. Without this option, they default to a signed char. </p>
<p class="enddd"></p>
</dd>
<dt><code>-funsigned-bitfields</code> </dt>
<dd><p class="startdd">This option changes the binary interface!<br  />
 Make any unqualified bitfield type unsigned. By default, they are signed. </p>
<p class="enddd"></p>
</dd>
<dt><code>-fshort-enums</code> </dt>
<dd><p class="startdd">This option changes the binary interface!<br  />
 Allocate to an <code>enum</code> type only as many bytes as it needs for the declared range of possible values. Specifically, the enum type will be equivalent to the smallest integer type which has enough room. </p>
<p class="enddd"></p>
</dd>
<dt><code>-fpack-struct</code> </dt>
<dd><p class="startdd">This option changes the binary interface!<br  />
 Pack all structure members together without holes. </p>
<p class="enddd"></p>
</dd>
<dt><code>-fno-jump-tables</code> </dt>
<dd><p class="startdd">Do not generate tablejump instructions. By default, jump tables can be used to optimize <code>switch</code> statements. When turned off, sequences of compare statements are used instead. Jump tables are usually faster to execute on average, but in particular for <code>switch</code> statements, where most of the jumps would go to the default label, they might waste a bit of flash memory.</p>
<p class="interdd">Note: Sinve GCC v4.9.2, tablejump code uses the <code>ELPM</code> instruction to read from jump tables. In older version, use the <code>-fno-jump-tables</code> switch when compiling a bootloader for devices with more than 64 KiB of code memory. </p>
<p class="enddd"></p>
</dd>
<dt><code>-ffreestanding</code> </dt>
<dd><p class="startdd">Assume a "freestanding" environment as per the C standard. This turns off automatic builtin functions (though they can still be reached by prepending <code>__builtin_</code> to the actual function name). It also makes the compiler not complain when <code>main()</code> is declared with a <code>void</code> return type. (In most cases, <code>main()</code> won't even return anyway, and hence using a return type of <code>int</code> has no downsides at all).</p>
<p class="enddd">However, this option also turns off all optimizations normally done by the compiler which assume that functions known by a certain name behave as described by the standard. For example, applying the function <a class="el" href="group__avr__string.html#ga219836f542ce53545052bed5353820ca" title="Calculate the length of a string.">strlen()</a> to a literal string will normally cause the compiler to immediately replace that call by the actual length of the string, while with <code>-ffreestanding</code>, it will always call <a class="el" href="group__avr__string.html#ga219836f542ce53545052bed5353820ca" title="Calculate the length of a string.">strlen()</a> at run-time.  </p>
</dd>
</dl>
<h1><a class="anchor" id="using_avr_as"></a>
Options for the assembler avr-as</h1>
<dl class="section note"><dt>Note</dt><dd>The preferred way to assemble a file is by means of using <code>avr-gcc</code>:<ul>
<li><code>avr-gcc</code>, which is a driver program to call sub-programs like the compiler proper or the assembler, knows which options it has to add to the assembler's command line, like: <code>-mmcu=<em>arch</em></code>, <code>-mno-skip-bug</code>, etc.</li>
<li><code>avr-gcc</code> will call the C preprocessor on the assembler input for sources with extensions <code>.S</code> and <code>.sx</code>. For other extensions, use <pre class="fragment">$ avr-gcc -x assembler-with-cpp file.asm ...
</pre> This allows to use C preprocessor directives like <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="io_8h.html">avr/io.h</a>&gt;</span></div>
<div class="ttc" id="aio_8h_html"><div class="ttname"><a href="io_8h.html">io.h</a></div></div>
</div><!-- fragment --> in assembly sources.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="using_avr_as_mach_opts"></a>
Machine-specific assembler options</h2>
<dl>
<dt><code>-mmcu=</code><em>architecture</em> </dt>
<dd></dd>
<dt><code>-mmcu=</code><em>mcu</em> </dt>
<dd><p class="startdd"><code>avr-as</code> does not support all <em>mcu</em>s supported by the compiler. As explained in the note above, the preferred way to run the assembler is by using the compiler driver <code>avr-gcc</code>. </p>
<p class="enddd"></p>
</dd>
<dt><code>-mall-opcodes</code> </dt>
<dd><p class="startdd">Turns off opcode checking, and allows any possible AVR opcode to be assembled. </p>
<p class="enddd"></p>
</dd>
<dt><code>-mno-skip-bug</code> </dt>
<dd><p class="startdd">Don't emit a warning when trying to skip a 2-word instruction with a <code>CPSE/SBIC/SBIS/SBRC/SBRS</code> instruction. Early AVR devices suffered from a hardware bug where these instructions could not be properly skipped. </p>
<p class="enddd"></p>
</dd>
<dt><code>-mno-wrap</code> </dt>
<dd><p class="startdd">For <code>RJMP/RCALL</code> instructions, don't allow the target address to wrap around for devices that have more than 8 KiB of memory. </p>
<p class="enddd"></p>
</dd>
<dt><code>--gstabs</code> </dt>
<dd><p class="startdd">Generate <code>.stabs</code> debugging symbols for assembler source lines. This enables <code>avr-gdb</code> to trace through assembler source files. This option <em>must not</em> be used when assembling sources that have been generated by the C compiler; these files already contain the appropriate line number information from the C source files. </p>
<p class="enddd"></p>
</dd>
<dt><code>-a[cdhlmns=<em>file</em>]</code> </dt>
<dd>Turn on the assembler listing. The sub-options are: <ul>
<li>
<code>c</code> omit false conditionals </li>
<li>
<code>d</code> omit debugging directives </li>
<li>
<code>h</code> include high-level source </li>
<li>
<code>l</code> include assembly </li>
<li>
<code>m</code> include macro expansions </li>
<li>
<code>n</code> omit forms processing </li>
<li>
<code>s</code> include symbols </li>
<li>
<code>=<em>file</em></code> set the name of the listing file </li>
</ul>
The various sub-options can be combined into a single <code>-a</code> option list; <em>=file</em> must be the last one in that case.  </dd>
</dl>
<h2><a class="anchor" id="using_avr_example"></a>
Examples for assembler options passed through the C compiler</h2>
<p>Remember that assembler options can be passed from the C compiler frontend using <code>-Wa</code> (see <a class="el" href="using_tools.html#gcc_minusW">gcc_minusW</a> above), so in order to include the C source code into the assembler listing in file <code>foo.lss</code>, when compiling <code>foo.c</code>, the following compiler command-line can be used:</p>
<pre class="fragment">$ avr-gcc -mmcu=atmega8 -c foo.c -o foo.o -Wa,-ahls=foo.lss
</pre><p>In order to pass an assembler file through the C preprocessor first, and have the assembler generate line number debugging information for it, the following command can be used:</p>
<pre class="fragment">$ avr-gcc -c -x assembler-with-cpp -o foo.o foo.asm -Wa,--gstabs
</pre><p>Note that on Unix systems that have case-distinguishing file systems, specifying a file name with the suffix <code>.S</code> (upper-case letter <code>S</code>) will make the compiler automatically assume <code>-x assembler-with-cpp</code>, while using <code>.s</code> would pass the file directly to the assembler (no preprocessing done).</p>
<h1><a class="anchor" id="using_avr_ld"></a>
Controlling the linker avr-ld</h1>
<dl class="section note"><dt>Note</dt><dd>It is highly recommended to use the compiler driver <code>avr-gcc</code> or <code>avr-g++</code> for linking.<ul>
<li>The driver knows which options to pass down to the linker. This includes the correct multilib path, support libraries like <code>libc.a</code>, <code>libm.a</code>, <code>libgcc.a</code> and <code>lib<em>mcu</em>.a</code>, as well as options for LTO (link-time optimization) and options for plugins (that call back the compiler to compile LTO byte code), startup code and many more.</li>
<li>The driver program understands options like <code>-l<em>lib</em></code>, <code>-L<em>path</em></code>, <code>Ttext</code>, <code>Tdata</code>, <code>Tbss</code> and <code>-T <em>script</em></code>, so no <code>-Wl</code> is required for them.</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="using_sel_ld_opts"></a>
Selected linker options</h2>
<p>A number of the standard options might be of interest to AVR users.</p>
<dl>
<dt><a class="anchor" id="opt_defsym"></a><code>--defsym <em>symbol=expr</em></code> </dt>
<dd><p class="startdd">Define a global symbol <em>symbol</em> using <em>expr</em> as the value.</p>
<p class="enddd"></p>
</dd>
<dt><code>-M</code> </dt>
<dd><p class="startdd">Print a linker map to <code>stdout</code>.</p>
<p class="enddd"></p>
</dd>
<dt><code>-Map <em>mapfile</em></code> </dt>
<dd><p class="startdd">Print a linker map to <em>mapfile</em>.</p>
<p class="enddd"></p>
</dd>
<dt><code>--cref</code> </dt>
<dd><p class="startdd">Output a cross reference table to the map file (in case <code>-Map</code> is also present), or to <code>stdout</code>. </p>
<p class="enddd"></p>
</dd>
<dt><code>--gc-sections</code> </dt>
<dd><p class="startdd">Only keep input sections that are referenced (by other sections or the entry symbol), and that are not marked as <code>KEEP</code> in the linker script. This is used to reduce code size, usually together with compiler option <code>-ffunction-sections</code> so that input section granularity is on function level rather than on the level of compilation units. </p>
<p class="enddd"></p>
</dd>
<dt><code>--section-start <em>sectionname=org</em></code> </dt>
<dd><p class="startdd">Start section <em>sectionname</em> at absolute address <em>org</em>.</p>
<p class="enddd"></p>
</dd>
<dt><code>--relax</code> </dt>
<dd>Don't use this option directly or per <code>-Wl,--relax</code>. Instead, link with <code>avr-gcc ... -mrelax</code>.  </dd>
</dl>
<h2><a class="anchor" id="using_pass_ld_opts"></a>
Passing linker options from the C compiler</h2>
<p>By default, all unknown non-option arguments on the <code>avr-gcc</code> command-line (i. e., all filename arguments that don't have a suffix that is handled by <code>avr-gcc</code>) are passed straight to the linker. Thus, all files ending in <code>.o</code> (object files) and <code>.a</code> (object libraries) are provided to the linker.</p>
<p>System libraries are usually not passed by their explicit filename but rather using the <code>-l</code> option which uses an abbreviated form of the archive filename (see above). AVR-LibC ships system libraries, <code>libc.a</code>, <code>libm.a</code> and <code>lib<em>mcu</em>.a</code>. While the standard library <code>libc.a</code> will always be searched for unresolved references when the linker is started using the C compiler frontend (i. e., there's always at least one implied <code>-lc</code> option), the mathematics library <code>libm.a</code> is only automatically added in GCC v4.7 and above. On older versions, it needs to be explicitly requested using <code>-lm</code>.</p>
<p>Conventionally, Makefiles use the <code>make</code> macro <code>LDLIBS</code> to keep track of <code>-l</code> (and possibly <code>-L</code>) options that should only be appended to the C compiler command-line when linking the final binary. In contrast, the macro <code>LDFLAGS</code> is used to store other command-line options to the C compiler that should be passed as options during the linking stage. The difference is that options are placed early on the command-line, while libraries are put at the end since they are to be used to resolve global symbols that are still unresolved at this point.</p>
<p>Specific linker flags can be passed from the C compiler command-line using the <code>-Wl</code> compiler option, see <a class="el" href="using_tools.html#gcc_minusW">gcc_minusW</a> above. This option requires that there be no spaces in the appended linker option, while some of the linker options above (like <code>-Map</code> or <code>--defsym</code>) would require a space. In these situations, the space can be replaced by an equal sign as well. For example, the following command-line can be used to compile <code>foo.c</code> into an executable, and also produce a link map that contains a cross-reference list in the file <code>foo.map:</code> </p>
<pre class="fragment">$ avr-gcc -mmcu=atmega8 foo.c -o foo.elf -Wl,-Map,foo.map -Wl,--cref
</pre><p>Alternatively, a comma as a placeholder will be replaced by a space before passing the option to the linker. So for a device with external SRAM, the following command-line would cause the linker to place the data segment at address 0x2000 in the SRAM:</p>
<pre class="fragment">$ avr-gcc -mmcu=atmega128 foo.c -o foo.elf -Wl,-Tdata,0x802000
</pre><p>See the explanation of the <a class="el" href="mem_sections.html#sec_dot_data">data section</a> for why 0x800000 needs to be added to the actual value. Note that the stack will still remain in internal RAM, through the symbol <code>__stack</code> that is provided by the run-time startup code. This is probably a good idea anyway (since internal RAM access is faster), and even required for some early devices that had hardware bugs preventing them from using a stack in external RAM. Note also that the heap for <code>malloc()</code> will still be placed after all the variables in the data section, so in this situation, no stack/heap collision can occur.</p>
<p>In order to relocate the stack from its default location at the top of interns RAM, the value of the symbol <code>__stack</code> can be changed on the linker command-line. As the linker is typically called from the compiler frontend, this can be achieved using a compiler option like</p>
<div class="fragment"><div class="line">-Wl,--defsym=__stack=0x8003ff</div>
</div><!-- fragment --><p>The above will make the code use stack space from RAM address 0x3ff downwards. The amount of stack space available then depends on the bottom address of internal RAM for a particular device. It is the responsibility of the application to ensure the stack does not grow out of bounds, as well as to arrange for the stack to not collide with variable allocations made by the compiler (sections .data and .bss). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 24 2025 20:40:10 for AVR-LibC by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.9.6
</small></address>
</body>
</html>
