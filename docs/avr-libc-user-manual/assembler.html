<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<title>AVR-LibC: AVR-LibC and Assembler Programs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="dox.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">AVR-LibC
   &#160;<span id="projectnumber">2.2.0</span>
   </div>
   <div id="projectbrief">Standard C library for AVR-GCC</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table>
  <tr>
    <td align="left"><a href="https://avrdudes.github.io/avr-libc/"><h2>AVR-LibC Documentation</h2></a></td>
    <td align="center" colspan=4><img src="avr-libc-logo.png" alt="Logo" align="middle" border="0"></td>
    <td align="right"><a href="https://github.com/avrdudes/avr-libc/"><h2>AVR-LibC Development Pages</h2></a></td>
  </tr>
  <tr>
    <td align="center" width="16%"><a href="index.html"><h2>Main Page</h2></a></td>
    <td align="center" width="16%"><a href="pages.html"><h2>User Manual</h2></a></td>
    <td align="center" width="16%"><a href="modules.html"><h2>Library Reference</h2></a></td>
    <td align="center" width="16%"><a href="FAQ.html"><h2>FAQ</h2></a></td>
    <td align="center" width="16%"><a href="group__demos.html"><h2>Example Projects</h2></a></td>
    <td align="center" width="16%"><a href="files.html"><h2>File List</h2></a></td>
  </tr>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">AVR-LibC and Assembler Programs </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a class="el" href="assembler.html#ass_intro">Introduction</a></li>
<li><a class="el" href="assembler.html#ass_tools">Invoking the Compiler</a></li>
<li><a class="el" href="assembler.html#ass_example">Example Program</a></li>
<li><a class="el" href="assembler.html#ass_directives">Assembler Directives</a><ul>
<li><a class="el" href="assembler.html#ass_sections">Sections</a></li>
<li><a class="el" href="assembler.html#ass_symbols">Symbols</a></li>
<li><a class="el" href="assembler.html#ass_data_and_align">Data and Alignment</a></li>
</ul>
</li>
<li><a class="el" href="assembler.html#ass_modifiers">Operand Modifiers</a></li>
</ul>
<h1><a class="anchor" id="ass_intro"></a>
Introduction</h1>
<p>There might be several reasons to write code for AVR microcontrollers using plain assembler source code. Among them are:</p>
<ul>
<li>Code for devices that do not have RAM and are thus not supported by the C compiler.</li>
<li>Code for very time-critical applications.</li>
<li>Special tweaks that cannot be done in C.</li>
</ul>
<p>Usually, all but the first could probably be done easily using the <a class="el" href="inline_asm.html">inline assembler</a> facility of the compiler.</p>
<p>Although AVR-LibC is primarily targeted to support programming AVR microcontrollers using the C (and C++) language, there's limited support for direct assembler usage as well. The benefits of it are:</p>
<ul>
<li>Use of the C preprocessor and thus the ability to use the same symbolic constants that are available to C programs, as well as a flexible macro concept that can use any valid C identifier as a macro (whereas the assembler's macro concept is basically targeted to use a macro in place of an assembler instruction).</li>
<li>Use of the runtime framework like automatically assigning interrupt vectors. For devices that have RAM, <a class="el" href="mem_sections.html#sec_dot_init">initializing the RAM variables</a> can also be utilized.</li>
</ul>
<h1><a class="anchor" id="ass_tools"></a>
Invoking the Compiler</h1>
<p>For the purpose described in this document, the assembler and linker are usually not invoked manually, but rather using the C compiler frontend (<code>avr-gcc</code>) that in turn will call the assembler and linker as required.</p>
<p>This approach has the following advantages:</p>
<ul>
<li>There is basically only one program to be called directly, <code>avr-gcc</code>, regardless of the actual source language used.</li>
<li>The invokation of the C preprocessor will be automatic, and will include the appropriate options to locate required include files in the filesystem.</li>
<li>The invokation of the linker will be automatic, and will include the appropriate options to locate additional libraries as well as the application start-up code (<code>crt<em>XXX</em>.o</code>) and linker script.</li>
</ul>
<p>Note that the invokation of the C preprocessor will be automatic when the filename provided for the assembler file ends in <code>.S</code> (the capital letter "s"). This would even apply to operating systems that use case-insensitive filesystems since the actual decision is made based on the case of the filename suffix given on the command-line, not based on the actual filename from the file system.</p>
<p>As an alternative to using <code>.S</code>, the suffix <code>.sx</code> is recognized for this purpose (starting with GCC v4.3). This is primarily meant to be compatible with other compiler environments that have been providing this variant before in order to cope with operating systems where filenames are case-insensitive (and, with some versions of <code>make</code> that could not distinguish between <code>.s</code> and <code>.S</code> on such systems).</p>
<p>Alternatively, the language can explicitly be specified using the <code><a class="el" href="using_tools.html#opt_x">-x assembler-with-cpp</a></code> option.</p>
<h1><a class="anchor" id="ass_example"></a>
Example Program</h1>
<p>The following annotated example features a simple 100 kHz square wave generator using an AT90S1200 clocked with a 10.7 MHz crystal. Pin PD6 will be used for the square wave output.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="io_8h.html">avr/io.h</a>&gt;</span>           <span class="comment">// Note [1]</span></div>
<div class="line"> </div>
<div class="line">work    =   16                <span class="comment">// Note [2]</span></div>
<div class="line">tmp     =   17</div>
<div class="line"> </div>
<div class="line">inttmp  =   19</div>
<div class="line">intsav  =   0</div>
<div class="line"> </div>
<div class="line">SQUARE  =   PD6               <span class="comment">// Note [3]</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define IO(x) _SFR_IO_ADDR(x)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Note [4]:</span></div>
<div class="line"><span class="comment">// 100 kHz =&gt; 200000 edges/s</span></div>
<div class="line">tmconst = 10700000 / 200000</div>
<div class="line"> </div>
<div class="line"><span class="comment">// # clocks in ISR until TCNT0 is set</span></div>
<div class="line">fuzz = 8</div>
<div class="line"> </div>
<div class="line">.text</div>
<div class="line"> </div>
<div class="line">.global main                        <span class="comment">// Note [5]</span></div>
<div class="line">main:</div>
<div class="line">    rcall   ioinit</div>
<div class="line">1:  rjmp    1b                      <span class="comment">// Note [6]</span></div>
<div class="line"> </div>
<div class="line">.global TIMER0_OVF_vect             <span class="comment">// Note [7]</span></div>
<div class="line">TIMER0_OVF_vect:</div>
<div class="line">    ldi     inttmp, 256 - tmconst + fuzz</div>
<div class="line">    out     IO(TCNT0), inttmp       <span class="comment">// Note [8]</span></div>
<div class="line"> </div>
<div class="line">    in      intsav, IO(SREG)        <span class="comment">// Note [9]</span></div>
<div class="line"> </div>
<div class="line">    sbic    IO(PORTD), SQUARE</div>
<div class="line">    rjmp    1f</div>
<div class="line">    <a class="code hl_define" href="group__deprecated__items.html#ga014ef751e83f97569c06f3cdd888f3f7">sbi</a>     IO(PORTD), SQUARE</div>
<div class="line">    rjmp    2f</div>
<div class="line">1:  <a class="code hl_define" href="group__deprecated__items.html#ga08ee265dc07048dbb5a8b6c84551d520">cbi</a>     IO(PORTD), SQUARE</div>
<div class="line">2:</div>
<div class="line">    out     IO(SREG), intsav</div>
<div class="line">    <a class="code hl_define" href="group__avr__interrupts.html#ga3b991e8168db8fc866e31f9a6d10533b">reti</a></div>
<div class="line"> </div>
<div class="line">ioinit:</div>
<div class="line">    <a class="code hl_define" href="group__deprecated__items.html#ga014ef751e83f97569c06f3cdd888f3f7">sbi</a>     IO(DDRD), SQUARE</div>
<div class="line"> </div>
<div class="line">    ldi     work, <a class="code hl_define" href="group__avr__sfr.html#ga11643f271076024c395a93800b3d9546">_BV</a>(TOIE0)</div>
<div class="line">    out     IO(TIMSK), work</div>
<div class="line"> </div>
<div class="line">    ldi     work, <a class="code hl_define" href="group__avr__sfr.html#ga11643f271076024c395a93800b3d9546">_BV</a>(CS00)         <span class="comment">// tmr0:  CK/1</span></div>
<div class="line">    out     IO(TCCR0), work</div>
<div class="line"> </div>
<div class="line">    ldi     work, 256 - tmconst</div>
<div class="line">    out     IO(TCNT0), work</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="group__avr__interrupts.html#gaad5ebd34cb344c26ac87594f79b06b73">sei</a></div>
<div class="line"> </div>
<div class="line">    ret</div>
<div class="line"> </div>
<div class="line">.global __vector_default            <span class="comment">// Note [10]</span></div>
<div class="line">__vector_default:</div>
<div class="line">    <a class="code hl_define" href="group__avr__interrupts.html#ga3b991e8168db8fc866e31f9a6d10533b">reti</a></div>
<div class="ttc" id="agroup__avr__interrupts_html_ga3b991e8168db8fc866e31f9a6d10533b"><div class="ttname"><a href="group__avr__interrupts.html#ga3b991e8168db8fc866e31f9a6d10533b">reti</a></div><div class="ttdeci">#define reti()</div><div class="ttdef"><b>Definition:</b> interrupt.h:242</div></div>
<div class="ttc" id="agroup__avr__interrupts_html_gaad5ebd34cb344c26ac87594f79b06b73"><div class="ttname"><a href="group__avr__interrupts.html#gaad5ebd34cb344c26ac87594f79b06b73">sei</a></div><div class="ttdeci">#define sei()</div><div class="ttdef"><b>Definition:</b> interrupt.h:76</div></div>
<div class="ttc" id="agroup__avr__sfr_html_ga11643f271076024c395a93800b3d9546"><div class="ttname"><a href="group__avr__sfr.html#ga11643f271076024c395a93800b3d9546">_BV</a></div><div class="ttdeci">#define _BV(bit)</div><div class="ttdef"><b>Definition:</b> sfr_defs.h:208</div></div>
<div class="ttc" id="agroup__deprecated__items_html_ga014ef751e83f97569c06f3cdd888f3f7"><div class="ttname"><a href="group__deprecated__items.html#ga014ef751e83f97569c06f3cdd888f3f7">sbi</a></div><div class="ttdeci">#define sbi(port, bit)</div><div class="ttdef"><b>Definition:</b> deprecated.h:213</div></div>
<div class="ttc" id="agroup__deprecated__items_html_ga08ee265dc07048dbb5a8b6c84551d520"><div class="ttname"><a href="group__deprecated__items.html#ga08ee265dc07048dbb5a8b6c84551d520">cbi</a></div><div class="ttdeci">#define cbi(port, bit)</div><div class="ttdef"><b>Definition:</b> deprecated.h:222</div></div>
<div class="ttc" id="aio_8h_html"><div class="ttname"><a href="io_8h.html">io.h</a></div></div>
</div><!-- fragment --><dl>
<dt>Note [1] </dt>
<dd>As in C programs, this includes the central processor-specific file containing the IO port definitions for the device. Note that not all include files can be included into assembler sources.  </dd>
<dt>Note [2] </dt>
<dd><p class="startdd">Assignment of registers to symbolic names used locally. Another option would be to use a C preprocessor macro instead:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define work 16 </span></div>
</div><!-- fragment -->  </dd>
<dt>Note [3] </dt>
<dd>Our bit number for the square wave output. Note that the right-hand side consists of a CPP macro which will be substituted by its value (6 in this case) before actually being passed to the assembler.  </dd>
<dt>Note [4] </dt>
<dd><p class="startdd">The assembler uses integer operations in the host-defined integer size (32 bits or longer) when evaluating expressions. This is in contrast to the C compiler that uses the C type <code>int</code> by default in order to calculate constant integer expressions.</p>
<p class="enddd">In order to get a 100 kHz output, we need to toggle the PD6 line 200000 times per second. Since we use timer 0 without any prescaling options in order to get the desired frequency and accuracy, we already run into serious timing considerations: while accepting and processing the timer overflow interrupt, the timer already continues to count. When pre-loading the <code>TCCNT0</code> register, we therefore have to account for the number of clock cycles required for interrupt acknowledge and for the instructions to reload <code>TCCNT0</code> (4 clock cycles for interrupt acknowledge, 2 cycles for the jump from the interrupt vector, 2 cycles for the 2 instructions that reload <code>TCCNT0</code>). This is what the constant <code>fuzz</code> is for.  </p>
</dd>
<dt>Note [5] </dt>
<dd>External functions need to be declared to be <code>.global</code>. <code>main</code> is the application entry point that will be jumped to from the ininitalization routine in <code>crts1200.o</code>.  </dd>
<dt>Note [6] </dt>
<dd>The main loop is just a single jump back to itself. Square wave generation itself is completely handled by the timer 0 overflow interrupt service. A <code>sleep</code> instruction (using idle mode) could be used as well, but probably would not conserve much energy anyway since the interrupt service is executed quite frequently.  </dd>
<dt>Note [7] </dt>
<dd>Interrupt functions can get the <a class="el" href="group__avr__interrupts.html#avr_signames">usual names</a> that are also available to C programs. The linker will then put them into the appropriate interrupt vector slots. Note that they must be declared <code>.global</code> in order to be acceptable for this purpose. This will only work if <code>&lt;<a class="el" href="io_8h.html">avr/io.h</a>&gt;</code> has been included. Note that the assembler or linker have no chance to check the correct spelling of an interrupt function, so it should be double-checked. (When analyzing the resulting object file using <code>avr-objdump</code> or <code>avr-nm</code>, a name like <code>__vector_<em>N</em></code> should appear, with <em>N</em> being a small integer number.)  </dd>
<dt>Note [8] </dt>
<dd><p class="startdd">As explained in the section about <a class="el" href="group__avr__sfr__notes.html">special function registers</a>, the actual IO port address should be obtained using the macro <code>_SFR_IO_ADDR</code>. (The AT90S1200 does not have RAM thus the memory-mapped approach to access the IO registers is not available. It would be slower than using <code>in</code> / <code>out</code> instructions anyway.)</p>
<p class="enddd">Since the operation to reload <code>TCCNT0</code> is time-critical, it is even performed before saving <code>SREG</code>. Obviously, this requires that the instructions involved would not change any of the flag bits in <code>SREG</code>.  </p>
</dd>
<dt><a class="anchor" id="ass_isr"></a>Note [9] </dt>
<dd><p class="startdd">Interrupt routines must not clobber the global CPU state. Thus, it is usually necessary to save at least the state of the flag bits in <code>SREG</code>. (Note that this serves as an example here only since actually, all the following instructions would not modify <code>SREG</code> either, but that's not commonly the case.)</p>
<p class="interdd">Also, it must be made sure that registers used inside the interrupt routine do not conflict with those used outside. In the case of a RAM-less device like the AT90S1200, this can only be done by agreeing on a set of registers to be used exclusively inside the interrupt routine; there would not be any other chance to "save" a register anywhere.</p>
<p class="enddd">If the interrupt routine is to be linked together with C modules, care must be taken to follow the <a class="el" href="FAQ.html#faq_reg_usage">register usage guidelines</a> imposed by the C compiler. Also, any register modified inside the interrupt sevice needs to be saved, usually on the stack.  </p>
</dd>
<dt>Note [10] </dt>
<dd>As explained in <a class="el" href="group__avr__interrupts.html">Interrupts</a>, a global "catch-all" interrupt handler that gets all unassigned interrupt vectors can be installed using the name <code>__vector_default</code>. This must be <code>.global</code>, and obviously, should end in a <code>reti</code> instruction. (By default, a jump to location 0 would be implied instead.)  </dd>
</dl>
<p><a class="anchor" id="ass_pseudoops"></a></p>
<h1><a class="anchor" id="ass_directives"></a>
Assembler Directives</h1>
<p>The directives available in the assembler are described in the GNU assembler (gas) manual at <a href="https://sourceware.org/binutils/docs/as/Pseudo-Ops.html">Assembler Directives</a>.</p>
<p>As gas comes from a Unix origin, its directives and overall assembler syntax is slightly different than the one being used by other assemblers. Numeric constants follow the C notation (prefix <code>0x</code> for hexadecimal constants, <code>0b</code> for binary constants), expressions use a C-like syntax.</p>
<p>Some common directives include:</p>
<p><a class="anchor" id="ass_sections"></a></p><table class="doxtable">
<caption>Assembler Directives: Sections</caption>
<tr>
<th>Section Ops </th><th>Description  </th></tr>
<tr>
<td><a class="anchor" id="dot_section"></a><code>.section&#160;<em>name</em>,<em>"flags"</em>,@<em>typ</em></code> </td><td>Put the following objects into <a class="el" href="mem_sections.html#sec_named">named section</a> <em>name</em>. Set <a class="el" href="mem_sections.html#sec_flags">section flags</a> <em>flags</em> and <a class="el" href="mem_sections.html#sec_type">section type</a> to <em>typ</em>  </td></tr>
<tr>
<td><a class="anchor" id="dot_pushsection"></a><code>.pushsection ...<br  />
.popsection</code> </td><td>Like <code>.section</code>, but also pushes the current section and subsection onto the section stack. The current section and subsection can be restored with <code>.popsection</code>.  </td></tr>
<tr>
<td><a class="anchor" id="dot_subsection"></a><code>.subsection <em>int</em></code> </td><td>Put the following code into subsection number <em>int</em> which is some integer. Subsections are located in order of increasing index within their input section. The default after switching to a new section by means of <code>.section</code> or <code>.pushsection</code> is subsection 0.  </td></tr>
<tr>
<td><code>.text</code><br  />
<code>.data</code><br  />
<code>.bss</code> </td><td>Put the following code into the <code>.text</code> section, <code>.data</code> section or <code>.bss</code> section, respectively. The assembler knows the right section flags and section type, for example the <code>.text</code> directive is basically the same like <code>.section .text,"ax",@progbits</code>. The directives support an optional subsection argument, see <code>.subsection</code> above.  </td></tr>
</table>
<p><a class="anchor" id="ass_symbols"></a></p><table class="doxtable">
<caption>Assembler Directives: Symbols</caption>
<tr>
<th>Symbol&#160;Ops </th><th>Description  </th></tr>
<tr>
<td><code>.global <em>sym</em> <br  />
.globl <em>sym</em></code> </td><td>Globalize symbol <em>sym</em> so that it can be referred to in other modules. When a symbol is used without prior declaration or definition, the symbol is implicitly global. The <code>.global</code> directive can also by used to refer to that symbol, so that the linker pulls in code that defines the symbol (provided such a symbol definition exists). For example, code that puts objects in the <code>.data</code> section and that assumes that the <a class="el" href="mem_sections.html#sec_dot_init">startup code</a> initializes that area, would use <code>.global __do_copy_data</code>.  </td></tr>
<tr>
<td><a class="anchor" id="dot_weak"></a><code>.weak <em>syms</em></code> </td><td>Declare symbols <em>syms</em> as weak symbols, where <em>syms</em> is a comma-separated list of symbols. This applies only when the symbols are also defined in the same module. When the linker encounters a weak symbol that is also defined as <code>.global</code> in a different module, then the linker will use the latter without raising a diagnostic about multiple symbol definitions.  </td></tr>
<tr>
<td><code>.type&#160;<em>sym,@kind</em></code> </td><td>Set the type of symbol <em>sym</em> to <em>kind</em>. Commonly used symbol types are <code>@function</code> for function symbols like <code>main</code> and <code>@object</code> for data symbols. This has an affect for disassemblers, debuggers and tools that show function / object properties.  </td></tr>
<tr>
<td><code>.size <em>sym,size</em></code> </td><td>Set the size associated with symbol <em>sym</em> to expression <em>size</em>. The linker works on the level of sections, it does not even know what functions are. This directive serves book-keeping, and may be useful for debuggers, disassemblers or tools that show which function / object consumes how much memory.  </td></tr>
<tr>
<td><code>.set&#160;<em>sym,&#160;expr</em> <br  />
.equ&#160;<em>sym,&#160;expr</em> <br  />
<em>sym&#160;=&#160;expr</em></code> </td><td>Set the value of symbol <em>sym</em> to the value of expression <em>expr</em>. When a global symbol is set multiple times, the value stored in the object file is the last value stored into the symbol.  </td></tr>
<tr>
<td><code>.extern</code> </td><td>Ignored for compatibility with other assemblers.  </td></tr>
<tr>
<td><code>.org</code> </td><td>Advance the location pointer to a specified offset <em>relative</em> to the beginning of the <a class="el" href="mem_sections.html#sec_input">input section</a>. The location counter cannot be moved backwards.<br  />
 This is a fairly pointless directive in an assembler environment that uses relocatable object files. The linker determines the final location of the objects. See the <a class="el" href="FAQ.html#faq_reloc_code">FAQ</a> on how to relocate code to a fixed address. </td></tr>
</table>
<p><a class="anchor" id="ass_data_and_align"></a></p><table class="doxtable">
<caption>Assembler Directives: Data and Alignment</caption>
<tr>
<th>Data Ops </th><th>Description </th><th>Alias  </th></tr>
<tr>
<td><code>.byte <em>list</em></code> </td><td>Allocate bytes specified by a list of comma-separated expressions. </td><td></td></tr>
<tr>
<td><code>.2byte <em>list</em></code> </td><td>Similar to <code>.byte</code>, but for 16-bit values. </td><td><code>.word</code>  </td></tr>
<tr>
<td><code>.4byte <em>list</em></code> </td><td>Similar to <code>.byte</code>, but for 32-bit values. </td><td><code>.long</code>  </td></tr>
<tr>
<td><code>.8byte <em>list</em></code> </td><td>Similar to <code>.byte</code>, but for 64-bit values. </td><td><code>.qword</code>  </td></tr>
<tr>
<td><code>.ascii <em>"string"</em></code> </td><td>Allocate a string of characters without \0 termination. </td><td></td></tr>
<tr>
<td><code>.asciz <em>"string"</em></code> </td><td>Allocate a \0 terminated string. </td><td></td></tr>
<tr>
<td><code>.float <em>list</em></code> </td><td>Allocate IEEE-754 single 32-bit floating-point values specified in the comma-separated <em>list</em>. </td><td></td></tr>
<tr>
<td><code>.double <em>list</em></code> </td><td>Same, but for IEEE-754 double 64-bit floats. </td><td></td></tr>
<tr>
<td><code>.space&#160;<em>num[,val]</em></code> </td><td>Allocate <em>num</em> bytes with value <em>val</em> where <em>val</em> is optional and defaults to zero. </td><td><code>.skip</code>  </td></tr>
<tr>
<td><code>.zero <em>num</em></code> </td><td>Insert <em>num</em> zero bytes. </td><td></td></tr>
<tr>
<th>Alignment Ops </th><th>Description </th><th>Alias  </th></tr>
<tr>
<td><code>.balign <em>val</em></code> </td><td>Align the following code to <em>val</em> bytes, where <em>val</em> is an absolute expression that evaluates to a power of 2. </td><td><code>.align</code>  </td></tr>
<tr>
<td><code>.p2align&#160;<em>expo</em></code> </td><td>Align the following code to 2<sup><em>expo</em></sup> bytes. </td><td></td></tr>
</table>
<p>Moreover, there is the <b><code>.macro</code></b> directive, which starts an assembler macro. The GNU assembler implements a powerful macro processor which even supports recursive macro definitions. For an example, see the gas documentation for <a href="https://sourceware.org/binutils/docs/as/Macro.html"><code>.macro</code></a>. A gas <code>.macro</code> can further be combined with C preprocessor directives. For some real-world examples, see the AVR-LibC sources <a href="https://github.com/avrdudes/avr-libc/blob/main/common/macros.inc"><code>macros.inc</code></a> and <a href="https://github.com/avrdudes/avr-libc/blob/main/common/asmdef.h"><code>asmdef.h</code></a>.</p>
<h1><a class="anchor" id="ass_modifiers"></a>
Operand Modifiers</h1>
<p>There are some AVR-specific operators available like <code>lo8()</code>, <code>hi8()</code>, <code>pm()</code>, <code>gs()</code> etc. For an overview see the documentation of the <a class="el" href="inline_asm.html#assembly_operand_modifiers">operand modifiers</a> in the inline assembly Cookbook.</p>
<p>Example: </p><pre class="fragment">    ldi	 r24, lo8(gs(somefunc))
    ldi	 r25, hi8(gs(somefunc))
    call      something
    subi r24, lo8(-(my_var))
    sbci r25, hi8(-(my_var))
</pre><p>This passes the address of function <code>somefunc</code> as the first parameter to function <code>something</code>, and <em>adds</em> the address of variable <code>my_var</code> to the 16-bit return value of <code>something</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 9 2024 00:30:42 for AVR-LibC by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.9.6
</small></address>
</body>
</html>
